<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="podman.io" />

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Using Systemd with Podman containers | podman.io</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Using Systemd with Podman containers" />
<meta name="author" content="emacchi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Using Systemd with Podman containers By Emilien Macchi GitHub Twitter Podman wasn’t designed to manage containers start-up order, dependency checking or failed containers recovery. In fact, this job can be done by external tools and this blog post describes how we can use the systemd initialization service to work with Podman containers." />
<meta property="og:description" content="Using Systemd with Podman containers By Emilien Macchi GitHub Twitter Podman wasn’t designed to manage containers start-up order, dependency checking or failed containers recovery. In fact, this job can be done by external tools and this blog post describes how we can use the systemd initialization service to work with Podman containers." />
<link rel="canonical" href="http://0.0.0.0:4000/blogs/2018/09/13/systemd.html" />
<meta property="og:url" content="http://0.0.0.0:4000/blogs/2018/09/13/systemd.html" />
<meta property="og:site_name" content="podman.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-13T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"emacchi"},"description":"Using Systemd with Podman containers By Emilien Macchi GitHub Twitter Podman wasn’t designed to manage containers start-up order, dependency checking or failed containers recovery. In fact, this job can be done by external tools and this blog post describes how we can use the systemd initialization service to work with Podman containers.","@type":"BlogPosting","url":"http://0.0.0.0:4000/blogs/2018/09/13/systemd.html","headline":"Using Systemd with Podman containers","dateModified":"2018-09-13T00:00:00-05:00","datePublished":"2018-09-13T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/blogs/2018/09/13/systemd.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="stylesheet" href="/assets/css/style.css?v=a5ad4b5b78f492f24c1321a74efdbcc0f20fd4cd">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header"><a href="">Podman</a></h1>
        <p class="header">Manage pods, containers, and container images.</p>

        <ul>
          <li><a class="buttons" href="/getting-started">Get Started</a>
          <li><a class="buttons" href="/community">Join Community</a>
          <li><a class="buttons" href="/blogs">Blog</a>
          <li><a class="buttons" href="/releases">Releases</a>
          <li><a class="buttons" href="/talks">Talks</a>
          <li><a class="buttons github" href="https://github.com/containers/libpod">View Code</a>
          <li><a class="buttons github" href="https://github.com/jberkus/podman.io">Edit Website</a>
        </ul>

        
          <p class="header">This project is maintained by the <a class="header name" href="https://github.com/jberkus">jberkus</a> organization.</p>

        <p class="header">Subscribe to the <a href="https://podman.io/feed.xml">blog feed</a>.</p>
        

        
      </header>

      <section>
        <p><img src="https://podman.io/images/podman.svg" alt="podman logo" /></p>

<h1 id="using-systemd-with-podman-containers">Using Systemd with Podman containers</h1>
<h2 id="by-emilien-macchi-github-twitter">By Emilien Macchi <a href="https://github.com/EmilienM">GitHub</a> <a href="https://twitter.com/EmilienMacchi">Twitter</a></h2>

<p>Podman wasn’t designed to manage containers start-up order, dependency
checking or failed containers recovery.
In fact, this job can be done by external tools and this blog post describes
how we can use the systemd initialization service to work with Podman
containers.</p>

<!--readmore-->

<p>Thanks to Systemd, containers can be managed in the same way than other
services on a Linux system.
Note that we configure Systemd on the host and not in the container, simply
because this is the simpliest and most popular way to far.
One other option (not covered in this article) would be to configure
Systemd within the container.</p>

<p>By setting up a Systemd unit file on the host, we can have the host
automatically start, stop, check the status, and otherwise manage a container
as a regular systemd service.</p>

<p>Let’s prepare the container (example with Redis):</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>podman pull docker.io/redis
<span class="nb">sudo </span>podman run <span class="nt">-d</span> <span class="nt">--name</span> redis <span class="nt">-p</span> 6379:6379 redis
</code></pre></div></div>

<p>Check that the container is actually running with <code class="highlighter-rouge">podman ps</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CONTAINER ID   IMAGE                            COMMAND                  CREATED          STATUS             PORTS                    NAMES
411a6c6be7d8   docker.io/library/redis:latest   docker-entrypoint.s...   10 minutes ago   Up 5 minutes ago   0.0.0.0:6379-&gt;6379/tcp   redis
</code></pre></div></div>

<p>Now, let’s create the Systemd unit file in <code class="highlighter-rouge">/etc/systemd/system/redis.service</code>:</p>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">Redis Podman container</span>
<span class="py">Wants</span><span class="p">=</span><span class="s">syslog.service</span>
<span class="nn">[Service]</span>
<span class="py">Restart</span><span class="p">=</span><span class="s">always</span>
<span class="py">ExecStart</span><span class="p">=</span><span class="s">/usr/bin/podman start -a redis</span>
<span class="py">ExecStop</span><span class="p">=</span><span class="s">/usr/bin/podman stop -t 10 redis</span>
<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">multi-user.target</span>
</code></pre></div></div>

<p>Enable and start the Systemd service:</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl <span class="nb">enable </span>redis.service
<span class="nb">sudo </span>systemctl start redis.service
</code></pre></div></div>

<p>The container is running redis-server:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo podman top redis
USER    PID   PPID   %CPU    ELAPSED            TTY   TIME   COMMAND
redis   1     0      0.000   15m14.490268713s   ?     0s     redis-server *:6379
</code></pre></div></div>

<p>Check that the service is seen as active in Systemd with
<code class="highlighter-rouge">sudo systemctl status redis</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>redis.service - Redis Podman container
   Loaded: loaded (/etc/systemd/system/redis.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2018-09-13 12:24:00 PDT; 1s ago
 Main PID: 1520 (podman)
    Tasks: 8 (limit: 4708)
   Memory: 7.8M
   CGroup: /system.slice/redis.service
           └─1520 /usr/local/bin/podman start -a redis

Sep 13 12:24:00 fedora28.localdomain systemd[1]: Started Redis Podman container.
</code></pre></div></div>

<p>Note that if you try to run <code class="highlighter-rouge">podman stop redis</code>, the container will be
restarted by Systemd because of to the “Restart=always” policy.
The proper way to stop the container is to run <code class="highlighter-rouge">sudo service redis stop</code>.</p>

<p>An alternative to Systemd for controlling containers lifecycle is to use
<a href="https://github.com/kubernetes-sigs/cri-o">CRI-O</a> but this would be for
another blog post :-).</p>

      </section>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
